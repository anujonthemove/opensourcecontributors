<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="icon" href="/favicon.ico">

    <title>GitHub Contributions Archive</title>

    <link href="/static/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/css/bootstrap-theme.min.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script src="/static/js/ie10-viewport-bug-workaround.js"></script>
    <script src="/static/js/handlebars-v3.0.3.js"></script>
    <script src="/static/js/moment.min.js"></script>
    <style>
     body {
       margin-top:60px;
     }
     .query-container {
       padding:10px;
     }
    </style>

    <!-- Handlebars! -->
    <script id="gollumevent-template" type="text/x-handlebars-template">
      <article>
        {{dateFmt created_at}} <a href="https://github.com/{{user}}">{{user}}</a>
        {{inflectEvent type}}
        to
        <a href="https://github.com/{{repo}}">{{repo}}</a>
      </article>
    </script>
    <script id="issuesevent-template" type="text/x-handlebars-template">
      <article>
        {{dateFmt created_at}} <a href="https://github.com/{{user}}">{{user}}</a>
        {{inflectEvent type}}
      </article>
    </script>
    <script id="pushevent-template" type="text/x-handlebars-template">
      <article>
        {{dateFmt created_at}} <a href="https://github.com/{{user}}">{{user}}</a>
        {{inflectEvent type}}
        {{distinct_commit_count}} commits, ending in:
        <a href="https://github.com/{{repo}}/commits/{{head}}">{{head}}</a>
        to
        <a href="https://github.com/{{repo}}">{{repo}}</a>
      </article>
    </script>
    <script id="commitcommentevent-template" type="text/x-handlebars-template">
      <article>
        {{dateFmt created_at}} <a href="https://github.com/{{user}}">{{user}}</a>
        {{inflectEvent type}}
      </article>
    </script>
    <script id="releaseevent-template" type="text/x-handlebars-template">
      <article>
        {{dateFmt created_at}} <a href="https://github.com/{{user}}">{{user}}</a>
        {{inflectEvent type}}
        <a href="https://github.com/{{repo}}/tags/{{tag_name}}">{{tag_name}}</a>
        of <a href="https://github.com/{{repo}}">{{repo}}</a>
      </article>
    </script>
    <script id="publicevent-template" type="text/x-handlebars-template">
      <article>
        {{dateFmt created_at}} <a href="https://github.com/{{user}}">{{user}}</a>
      {{inflectEvent type}}
      </article>
    </script>
    <script id="memberevent-template" type="text/x-handlebars-template">
      <article>
        {{dateFmt created_at}} <a href="https://github.com/{{user}}">{{user}}</a>
      {{inflectEvent type}}
      </article>
    </script>
    <script id="issuecommentevent-template" type="text/x-handlebars-template">
      <article>
        {{dateFmt created_at}} <a href="https://github.com/{{user}}">{{user}}</a>
      {{inflectEvent type}}
      </article>
    </script>

    <script>
     // Handlebars things
     Handlebars.registerHelper('dateFmt', function(d) {
       return moment(d).calendar();
     });
     Handlebars.registerHelper('inflectEvent', function(e) {
       verbs = {
         'GollumEvent': 'edited Wiki',
         'IssuesEvent': 'dealt with an issue', // should use action
         'PushEvent': 'pushed',
         'CommitCommentEvent': 'commented on commit',
         'ReleaseEvent': 'released version',
         'PublicEvent': 'open-sourced',
         'MemberEvent': 'added member',
         'IssueCommentEvent': 'commentedon issue',
       };
       return verbs[e];
     });
     eventTemplates = {
       'GollumEvent'        : Handlebars.compile($('#gollumevent-template').html()),
       'IssuesEvent'        : Handlebars.compile($('#issuesevent-template').html()),
       'PushEvent'          : Handlebars.compile($('#pushevent-template').html()),
       'CommitCommentEvent' : Handlebars.compile($('#commitcommentevent-template').html()),
       'ReleaseEvent'       : Handlebars.compile($('#releaseevent-template').html()),
       'PublicEvent'        : Handlebars.compile($('#publicevent-template').html()),
       'MemberEvent'        : Handlebars.compile($('#memberevent-template').html()),
       'IssueCommentEvent'  : Handlebars.compile($('#issuecommentevent-template').html()),
     }

      $(function() {
       $("form#user-query").submit(function(e) {
         e.preventDefault();
         var url = "/search/"+$("#query").val();
         $.getJSON(url, function(data) {
           $("#results").empty();

           $.each(data.events, function(i, value) {
             console.log(JSON.stringify(value));
             var content = eventTemplates[value.type](value);
             $("#results").append(content);
           });
         });
       });
     });
    </script>

    <!-- Custom styles for this template -->
    <!-- <link href="/static/css/theme.css" rel="stylesheet"> -->

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body role="document">

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">GitHub Contributions Archive</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li class="active"><a href="#">Home</a></li>
            <li><a href="http://hut8.io">Hut8.io</a></li>
            <li><a href="mailto:liambowen@gmail.com">Contact</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container theme-showcase" role="main">

      <!-- Main jumbotron for a primary marketing message or call to action -->
      <div class="jumbotron query-container">
        <p>
          <form class="form-inline" id="user-query">
            <div class="form-group">
              <label for="query" class="sr-only">GitHub Username</label>
              <input type="text" class="form-control" id="query" placeholder="GitHub User">
            </div>
            <button type="submit" class="btn btn-primary">Search</button>
          </form>
        </p>

      </div>

      <div  id="results">
      </div>

    </div> <!-- /container -->


  </body>
</html>
