<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="icon" href="/favicon.ico">

    <title>GitHub Contributions Archive</title>

    <link href="/static/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/css/bootstrap-theme.min.css" rel="stylesheet">
    <link href="/static/octicons/octicons.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script src="/static/js/ie10-viewport-bug-workaround.js"></script>
    <script src="/static/js/handlebars-v3.0.3.js"></script>
    <script src="/static/js/moment.min.js"></script>
    <style>
     body {
       margin-top:60px;
     }
     .query-container {
       padding:10px;
     }
     td {
       white-space: nowrap;
     }
    </style>

    <!-- Handlebars! -->
    <script id="gollumevent-template" type="text/x-handlebars-template">
      {{#ifMultiplePages this}}
      edited multiple Wiki pages:
      <ul>
      {{#each pages}}
        <li>
          {{action}} the page
          <a href="{{html_url}}">{{title}}</a>
          (<a href="{{html_url}}/_history">history</a>)
        </li>
      {{/each}}
      </ul>
      {{else}}
      {{#with pages.[0]}}
      {{action}} the Wiki page
      <a href="{{html_url}}">{{title}}</a>
      (<a href="{{html_url}}/_history">history</a>)
      {{/with}}
      {{/ifMultiplePages}}
    </script>
    <script id="issuesevent-template" type="text/x-handlebars-template">
        {{user}} {{action}} issue
        <a href="https://github.com/{{repo}}/issues/{{issue_number}}">
          {{issue_number}}
        </a>
    </script>
    <script id="pushevent-template" type="text/x-handlebars-template">
      pushed {{distinct_commit_count}}
      {{pluralize distinct_commit_count "commit" "commits"}}, ending in:
        <a href="https://github.com/{{repo}}/commits/{{head}}">{{formatSHA head}}</a>
    </script>
    <script id="commitcommentevent-template" type="text/x-handlebars-template">
      <article>
        {{dateFmt created_at}}
        <a href="https://github.com/{{user}}">{{user}}</a>
      </article>
    </script>
    <script id="releaseevent-template" type="text/x-handlebars-template">
      <article>
        {{dateFmt created_at}}
        <a href="https://github.com/{{user}}">{{user}}</a>
        released tag
        <a href="https://github.com/{{repo}}/tags/{{tag_name}}">{{tag_name}}</a>
        of <a href="https://github.com/{{repo}}">{{repo}}</a>
      </article>
    </script>
    <script id="publicevent-template" type="text/x-handlebars-template">
      <article>
        {{dateFmt created_at}}
        <a href="https://github.com/{{user}}">{{user}}</a> open-sourced
        <a href="https://github.com/{{repo}}">{{repo}}</a>!
      </article>
    </script>
    <script id="memberevent-template" type="text/x-handlebars-template">
      <article>
        {{dateFmt created_at}}
        <a href="https://github.com/{{user}}">{{user}}</a>
        {{target_action}}
        <a href="https://github.com/{{target_user}}">{{target_user}}</a> to
        <a href="https://github.com/{{repo}}">{{repo}}</a>
      </article>
    </script>
    <script id="issuecommentevent-template" type="text/x-handlebars-template">
      <article>
        {{dateFmt created_at}}
        <a href="https://github.com/{{user}}">{{user}}</a>
        {{target_action}}
        <a href="https://github.com/{{target_user}}">{{target_user}}</a> to
        <a href="https://github.com/{{repo}}">{{repo}}</a>
      </article>
    </script>
    <script id="contributions-template" type="text/x-handlebars-template">
      {{#if events}}
        <table class="table table-striped">
          <thead>
            <th>
              <!-- event type -->
            </th>
            <th>
              <span class="octicon octicon-calendar"></span>
            </th>
            <th>
              <span class="octicon octicon-repo"></span>
            </th>
            <th>
              <span class="octicon octicon-repo"></span>
            </th>
            <th>
              <!-- description -->
            </th>
            <th>
              <span class="octicon octicon-link"></span>
            </th>
          </thead>
          <tbody>
            {{#each events}}
            <tr>
              <td>
                <span title="{{type}}" class="octicon {{eventIcon type}}"></span>
              </td>
              <td title="{{created_at}}">
                {{dateFmt created_at}}
              </td>
              <td>
                <a href="https://github.com/{{repo}}">{{repo}}</a>
              </td>
              <td>
                <a href="https://github.com/{{user}}">{{user}}</a>
              </td>
              <td style="width:100%">
                {{> (selectEventPartial this) }}
              </td>
              <td>
                <a href=""></a>
              </td>
            </tr>
            {{/each}}
          </tbody>
        </table>
        {{else}}
        <h1>No results :(</h1>
        {{/if}}
    </script>

    <script>
      // Oxford commas code golf:
     // f=(a,b=a.pop())=>a[0]?a.join(', ')+(a[1]?',':'')+' and '+b:b
     // or
     // l=a.length;l>2&&(a[l-1]='and '+a[l-1]);a.join(l>2?', ':' and ')

     ///////////////////////
     // Handlebars things //
     ///////////////////////
     // Helpers
     Handlebars.registerHelper('pluralize', function(c, s, p) {
         return (c === 1) ? s : p;
     });
     Handlebars.registerHelper('dateFmt', function(d) {
         //return d ? moment(d).calendar() : "";
         return d ? moment(d).fromNow() : "";
     });
     Handlebars.registerHelper('ifMultiplePages', function(ctx, options) {
       return (ctx.pages.length > 1) ? options.fn(this) : options.inverse(this);
     });
     Handlebars.registerHelper("eventIcon", function(eventType) {
       var eventTypeData = {
         "GollumEvent"        : "book",
         "IssuesEvent"        : "issue-opened",
         "PushEvent"          : "repo-push",
         "CommitCommentEvent" : "comment",
         "ReleaseEvent"       : "tag",
         "PublicEvent"        : "megaphone",
         "MemberEvent"        : "person",
         "IssueCommentEvent"  : "comment-discussion"
       };
       var icon = eventTypeData[eventType];
       return "octicon-" + icon;
     });
     selectEventPartial = function(event) {
       return event["type"];
     }
     Handlebars.registerHelper("selectEventPartial", selectEventPartial);
     Handlebars.registerHelper("formatSHA", function(hash) {
       return hash.slice(0,7);
     });


     Handlebars.registerPartial("GollumEvent"        , $("#gollumevent-template").html());
     Handlebars.registerPartial("IssuesEvent"        , $("#issuesevent-template").html());
     Handlebars.registerPartial("PushEvent"          , $("#pushevent-template").html());
     Handlebars.registerPartial("CommitCommentEvent" , $("#commitcommentevent-template").html());
     Handlebars.registerPartial("ReleaseEvent"       , $("#releaseevent-template").html());
     Handlebars.registerPartial("PublicEvent"        , $("#publicevent-template").html());
     Handlebars.registerPartial("MemberEvent"        , $("#memberevent-template").html());
     Handlebars.registerPartial("IssueCommentEvent"  , $("#issuecommentevent-template").html());

     var renderTemplate = Handlebars.compile(
       $("#contributions-template").html()
     );

     $(function() {
       $("form#user-query").submit(function(e) {
         e.preventDefault();
         var url = "/search/"+$("#query").val();
         $.getJSON(url, function(data) {
             console.log("Found "+data.events.length+" events");
             $("#results").html(
               renderTemplate(data)
             );
         });
       });
     });
    </script>

    <!-- <link href="/static/css/theme.css" rel="stylesheet"> -->

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body role="document">

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">GitHub Contributions Archive</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li class="active"><a href="#">Home</a></li>
            <li><a href="http://hut8.io">Hut8.io</a></li>
            <li><a href="mailto:liambowen@gmail.com">Contact</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container theme-showcase" role="main">

      <div class="jumbotron query-container">
        <p>
          <form class="form-inline" id="user-query">
            <div class="form-group">
              <label for="query" class="sr-only">GitHub Username</label>
              <input type="text" class="form-control" id="query" placeholder="GitHub User">
            </div>
            <button type="submit" class="btn btn-primary">Search</button>
          </form>
        </p>
      </div>

      <div id="results">
      </div>

    </div> <!-- /container -->


  </body>
</html>
